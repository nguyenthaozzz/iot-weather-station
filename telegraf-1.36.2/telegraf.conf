# ===== INPUT: MQTT (nhận data từ Mosquitto) =====
[[inputs.mqtt_consumer]]
  servers = ["tcp://localhost:1883"]        # IP của broker
  topics = ["home/sensor/data/#"]           # Nhận mọi topic con
  qos = 0
  connection_timeout = "30s"

  # Ghi dữ liệu ngay khi nhận
  persistent_session = false
  client_id = "telegraf_mqtt"
  max_undelivered_messages = 500

  data_format = "json"                      # Dữ liệu ESP32 gửi dạng JSON
  tag_keys = ["location"]

  # Giảm trễ bằng cách flush ngay lập tức
  flush_interval = "0s"
  flush_jitter = "0s"


# ===== OUTPUT: InfluxDB v2 =====
[[outputs.influxdb_v2]]
  urls = ["http://localhost:8086"]
  token = "7zqvQrsWd2LvPCQAjTJinU73BfP5PuvME0ORWq22YBOyposQwgy-qlmx2t-xyEsZZ857otiwaXlTMgbDfrzzow=="
  organization = "university-project"
  bucket = "weather-data"

  # Viết dữ liệu ngay lập tức, không đợi batch
  flush_interval = "0s"
  flush_jitter = "0s"
  metric_batch_size = 1
  metric_buffer_limit = 1000
